log_std_log_N0 = log(10),
mean_log_R = 20,
log_std_log_R = log(10),
logit_log_R = 20,
mean_log_F = log(2),
#log_std_log_F = log(10),
logit_log_F_y = 20,
logit_log_F_a = 10,
log_vbk = log(1),
#log_Linf = log(100),
#log_t0 = 0,
log_cv_len = log(1),
log_std_index = log(1)
)
lower=unlist(parameters.L)
upper=unlist(parameters.U)
map = list(
#log_std_log_N0 = factor(NA),
#log_std_log_R = factor(NA),
log_std_log_F = factor(NA),
log_Linf=factor(NA),
log_t0=factor(NA)
#log_std_index=factor(NA)
)
rnames=c("dev_log_R","dev_log_F","dev_log_N0")
generate_map(mao)
generate_map(map)
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U)
p<-create_parameters(parameters = parameters,parameters.L = parameters.L,parameters.U = parameters.U)
p$parameters.L
pl<-p$parameters.L
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
library(ALSCL)
# input data
setwd("E:\\Oceanic Fisheries Ecosystem Laboratory\\krill")
cl<-read.table("CatL-5mm-all.csv",header=T,sep=",")
wgt<-read.table("wgt-5mm-all.csv",header=T,sep=",")
mat<-read.table("mat-5mm-all.csv",header=T,sep=",")
Y=21
A=5
L=9
parameters = list(
log_init_Z = 0.5,
log_std_log_N0 = log(1),
mean_log_R = 5,
log_std_log_R = log(1),
logit_log_R = log(0.01/0.99),
mean_log_F = log(0.3),
log_std_log_F = log(1),
logit_log_F_y = log(0.75/0.25),
logit_log_F_a = log(0.75/0.25),
log_vbk = log(0.3),
log_Linf = log(90),
log_t0 = log(1/60),
log_cv_len = log(0.3),
log_std_index = log(0.1),
# random effects
dev_log_R = rep(0,Y),
dev_log_F = array(0,c(A,Y)),
dev_log_N0 = rep(0,(A-1))
)
parameters.L = list(
# fixed effects
log_init_Z = log(0.01),
log_std_log_N0 = -Inf,
mean_log_R = log(10),
log_std_log_R = log(0.01),
logit_log_R = -30,
mean_log_F = log(0.01),
#log_std_log_F = log(0.01),
logit_log_F_y = -10,
logit_log_F_a = -10,
log_vbk = log(0.1),
#log_Linf = log(50),
#log_t0 = -20,
log_cv_len = log(0.01),
log_std_index = log(0.01)
)
parameters.U = list(
# fixed effects
log_init_Z = log(10),
log_std_log_N0 = log(10),
mean_log_R = 20,
log_std_log_R = log(10),
logit_log_R = 20,
mean_log_F = log(2),
#log_std_log_F = log(10),
logit_log_F_y = 20,
logit_log_F_a = 10,
log_vbk = log(1),
#log_Linf = log(100),
#log_t0 = 0,
log_cv_len = log(1),
log_std_index = log(1)
)
lower=unlist(parameters.L)
upper=unlist(parameters.U)
map = list(
#log_std_log_N0 = factor(NA),
#log_std_log_R = factor(NA),
log_std_log_F = factor(NA),
log_Linf=factor(NA),
log_t0=factor(NA)
#log_std_index=factor(NA)
)
rnames=c("dev_log_R","dev_log_F","dev_log_N0")
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U)
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
View(a)
a$opt
a$report
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45)
# stock assessment of krill
mat_func<-function(L50,L95,length)
{
b1=log(0.95/0.05)/(L95-L50)
bo = -L50*b1
logit_pt =  bo+b1*length
matp= exp(logit_pt)/(1+exp(logit_pt))
return(matp)
}
# input data
setwd("E:\\Oceanic Fisheries Ecosystem Laboratory\\krill")
cl<-read.table("CatL-5mm-all.csv",header=T,sep=",")
wgt<-read.table("wgt-5mm-all.csv",header=T,sep=",")
mat<-read.table("mat-5mm-all.csv",header=T,sep=",")
logN_at_len<-as.matrix(log(cl[,2:22]+1e-5))
na_matrix<-matrix(1,nrow=9,ncol=21)
na_matrix[which(cl[,2:22]==0)]=0
len_mid=c(15,23,28,33,38,43,48,53,58)
log_q<-log(mat_func(40,45,len_mid))
len_border=c(20,25,30,35,40,45,50,55)
age=c(1:5)
Y=21
A=5
L=9
weight=wgt[,2:22]
mat=mat[,2:22]
M=0.3
# prepare data
tmb.data1<-list(
logN_at_len=logN_at_len,
na_matrix=na_matrix,
log_q=log_q,
len_border=len_border,
age=age,
Y=Y,
A=A,
L=L,
weight=as.matrix(weight),
mat=as.matrix(mat),
M=M
)
parameters = list(
log_init_Z = 0.5,
log_std_log_N0 = log(1),
mean_log_R = 5,
log_std_log_R = log(1),
logit_log_R = log(0.01/0.99),
mean_log_F = log(0.3),
log_std_log_F = log(1),
logit_log_F_y = log(0.75/0.25),
logit_log_F_a = log(0.75/0.25),
log_vbk = log(0.3),
log_Linf = log(90),
log_t0 = log(1/60),
log_cv_len = log(0.3),
log_std_index = log(0.1),
# random effects
dev_log_R = rep(0,Y),
dev_log_F = array(0,c(A,Y)),
dev_log_N0 = rep(0,(A-1))
)
parameters.L = list(
# fixed effects
log_init_Z = log(0.01),
log_std_log_N0 = -Inf,
mean_log_R = log(10),
log_std_log_R = log(0.01),
logit_log_R = -30,
mean_log_F = log(0.01),
#log_std_log_F = log(0.01),
logit_log_F_y = -10,
logit_log_F_a = -10,
log_vbk = log(0.1),
#log_Linf = log(50),
#log_t0 = -20,
log_cv_len = log(0.01),
log_std_index = log(0.01)
)
parameters.U = list(
# fixed effects
log_init_Z = log(10),
log_std_log_N0 = log(10),
mean_log_R = 20,
log_std_log_R = log(10),
logit_log_R = 20,
mean_log_F = log(2),
#log_std_log_F = log(10),
logit_log_F_y = 20,
logit_log_F_a = 10,
log_vbk = log(1),
#log_Linf = log(100),
#log_t0 = 0,
log_cv_len = log(1),
log_std_index = log(1)
)
lower=unlist(parameters.L)
upper=unlist(parameters.U)
map = list(
#log_std_log_N0 = factor(NA),
#log_std_log_R = factor(NA),
log_std_log_F = factor(NA),
log_Linf=factor(NA),
log_t0=factor(NA)
#log_std_index=factor(NA)
)
rnames=c("dev_log_R","dev_log_F","dev_log_N0")
library("TMB")
compile("ACL_krill.cpp")
dyn.load("ACL_krill")
obj<-MakeADFun(tmb.data,parameters,random=rnames,map=map,DLL="ACL_krill",inner.control=list(trace=F, maxit=500))
cbind(opt$par,lower,upper)
# prepare data
tmb.data<-list(
logN_at_len=logN_at_len,
na_matrix=na_matrix,
log_q=log_q,
len_border=len_border,
age=age,
Y=Y,
A=A,
L=L,
weight=as.matrix(weight),
mat=as.matrix(mat),
M=M
)
parameters = list(
log_init_Z = 0.5,
log_std_log_N0 = log(1),
mean_log_R = 5,
log_std_log_R = log(1),
logit_log_R = log(0.01/0.99),
mean_log_F = log(0.3),
log_std_log_F = log(1),
logit_log_F_y = log(0.75/0.25),
logit_log_F_a = log(0.75/0.25),
log_vbk = log(0.3),
log_Linf = log(90),
log_t0 = log(1/60),
log_cv_len = log(0.3),
log_std_index = log(0.1),
# random effects
dev_log_R = rep(0,Y),
dev_log_F = array(0,c(A,Y)),
dev_log_N0 = rep(0,(A-1))
)
parameters.L = list(
# fixed effects
log_init_Z = log(0.01),
log_std_log_N0 = -Inf,
mean_log_R = log(10),
log_std_log_R = log(0.01),
logit_log_R = -30,
mean_log_F = log(0.01),
#log_std_log_F = log(0.01),
logit_log_F_y = -10,
logit_log_F_a = -10,
log_vbk = log(0.1),
#log_Linf = log(50),
#log_t0 = -20,
log_cv_len = log(0.01),
log_std_index = log(0.01)
)
parameters.U = list(
# fixed effects
log_init_Z = log(10),
log_std_log_N0 = log(10),
mean_log_R = 20,
log_std_log_R = log(10),
logit_log_R = 20,
mean_log_F = log(2),
#log_std_log_F = log(10),
logit_log_F_y = 20,
logit_log_F_a = 10,
log_vbk = log(1),
#log_Linf = log(100),
#log_t0 = 0,
log_cv_len = log(1),
log_std_index = log(1)
)
lower=unlist(parameters.L)
upper=unlist(parameters.U)
map = list(
#log_std_log_N0 = factor(NA),
#log_std_log_R = factor(NA),
log_std_log_F = factor(NA),
log_Linf=factor(NA),
log_t0=factor(NA)
#log_std_index=factor(NA)
)
rnames=c("dev_log_R","dev_log_F","dev_log_N0")
library("TMB")
compile("ACL_krill.cpp")
dyn.load("ACL_krill")
obj<-MakeADFun(tmb.data,parameters,random=rnames,map=map,DLL="ACL_krill",inner.control=list(trace=F, maxit=500))
opt<-nlminb(obj$par,obj$fn,obj$gr,lower=lower,upper=upper,control=list(trace=0,iter.max=2000,eval.max=10000))
library(ALSCL)
# stock assessment of krill
mat_func<-function(L50,L95,length)
{
b1=log(0.95/0.05)/(L95-L50)
bo = -L50*b1
logit_pt =  bo+b1*length
matp= exp(logit_pt)/(1+exp(logit_pt))
return(matp)
}
# input data
setwd("E:\\Oceanic Fisheries Ecosystem Laboratory\\krill")
cl<-read.table("CatL-5mm-all.csv",header=T,sep=",")
wgt<-read.table("wgt-5mm-all.csv",header=T,sep=",")
mat<-read.table("mat-5mm-all.csv",header=T,sep=",")
logN_at_len<-as.matrix(log(cl[,2:22]+1e-5))
na_matrix<-matrix(1,nrow=9,ncol=21)
na_matrix[which(cl[,2:22]==0)]=0
len_mid=c(15,23,28,33,38,43,48,53,58)
log_q<-log(mat_func(40,45,len_mid))
len_border=c(20,25,30,35,40,45,50,55)
age=c(1:5)
Y=21
A=5
L=9
weight=wgt[,2:22]
mat=mat[,2:22]
M=0.3
# prepare data
tmb.data<-list(
logN_at_len=logN_at_len,
na_matrix=na_matrix,
log_q=log_q,
len_border=len_border,
age=age,
Y=Y,
A=A,
L=L,
weight=as.matrix(weight),
mat=as.matrix(mat),
M=M
)
parameters = list(
log_init_Z = 0.5,
log_std_log_N0 = log(1),
mean_log_R = 5,
log_std_log_R = log(1),
logit_log_R = log(0.01/0.99),
mean_log_F = log(0.3),
log_std_log_F = log(1),
logit_log_F_y = log(0.75/0.25),
logit_log_F_a = log(0.75/0.25),
log_vbk = log(0.3),
log_Linf = log(90),
log_t0 = log(1/60),
log_cv_len = log(0.3),
log_std_index = log(0.1),
# random effects
dev_log_R = rep(0,Y),
dev_log_F = array(0,c(A,Y)),
dev_log_N0 = rep(0,(A-1))
)
parameters.L = list(
# fixed effects
log_init_Z = log(0.01),
log_std_log_N0 = -Inf,
mean_log_R = log(10),
log_std_log_R = log(0.01),
logit_log_R = -30,
mean_log_F = log(0.01),
#log_std_log_F = log(0.01),
logit_log_F_y = -10,
logit_log_F_a = -10,
log_vbk = log(0.1),
#log_Linf = log(50),
#log_t0 = -20,
log_cv_len = log(0.01),
log_std_index = log(0.01)
)
parameters.U = list(
# fixed effects
log_init_Z = log(10),
log_std_log_N0 = log(10),
mean_log_R = 20,
log_std_log_R = log(10),
logit_log_R = 20,
mean_log_F = log(2),
#log_std_log_F = log(10),
logit_log_F_y = 20,
logit_log_F_a = 10,
log_vbk = log(1),
#log_Linf = log(100),
#log_t0 = 0,
log_cv_len = log(1),
log_std_index = log(1)
)
lower=unlist(parameters.L)
upper=unlist(parameters.U)
map = list(
#log_std_log_N0 = factor(NA),
#log_std_log_R = factor(NA),
log_std_log_F = factor(NA),
log_Linf=factor(NA),
log_t0=factor(NA)
#log_std_index=factor(NA)
)
rnames=c("dev_log_R","dev_log_F","dev_log_N0")
library("TMB")
compile("ACL_krill.cpp")
dyn.load("ACL_krill")
obj<-MakeADFun(tmb.data,parameters,random=rnames,map=map,DLL="ACL_krill",inner.control=list(trace=F, maxit=500))
opt<-nlminb(obj$par,obj$fn,obj$gr,lower=lower,upper=upper,control=list(trace=0,iter.max=2000,eval.max=10000))
obj$gr(opt$par)
cbind(opt$par,lower,upper)
result<-obj$report()
par(mfrow=c(3,3),mar=c(1,2,1,1))
for(i in 1:9){
plot(logN_at_len[i,],ylim=c(-10,15))
lines(result$Elog_index[i,])
}
plot(result$SSB,type="l")
plot(result$Rec,type="l")
setwd("E:\\Oceanic Fisheries Ecosystem Laboratory\\krill")
cl<-read.table("CatL-5mm-all.csv",header=T,sep=",")
wgt<-read.table("wgt-5mm-all.csv",header=T,sep=",")
mat<-read.table("mat-5mm-all.csv",header=T,sep=",")
Y=21
A=5
L=9
parameters = list(
log_init_Z = 0.5,
log_std_log_N0 = log(1),
mean_log_R = 5,
log_std_log_R = log(1),
logit_log_R = log(0.01/0.99),
mean_log_F = log(0.3),
log_std_log_F = log(1),
logit_log_F_y = log(0.75/0.25),
logit_log_F_a = log(0.75/0.25),
log_vbk = log(0.3),
log_Linf = log(90),
log_t0 = log(1/60),
log_cv_len = log(0.3),
log_std_index = log(0.1),
# random effects
dev_log_R = rep(0,Y),
dev_log_F = array(0,c(A,Y)),
dev_log_N0 = rep(0,(A-1))
)
parameters.L = list(
# fixed effects
log_init_Z = log(0.01),
log_std_log_N0 = -Inf,
mean_log_R = log(10),
log_std_log_R = log(0.01),
logit_log_R = -30,
mean_log_F = log(0.01),
#log_std_log_F = log(0.01),
logit_log_F_y = -10,
logit_log_F_a = -10,
log_vbk = log(0.1),
#log_Linf = log(50),
#log_t0 = -20,
log_cv_len = log(0.01),
log_std_index = log(0.01)
)
parameters.U = list(
# fixed effects
log_init_Z = log(10),
log_std_log_N0 = log(10),
mean_log_R = 20,
log_std_log_R = log(10),
logit_log_R = 20,
mean_log_F = log(2),
#log_std_log_F = log(10),
logit_log_F_y = 20,
logit_log_F_a = 10,
log_vbk = log(1),
#log_Linf = log(100),
#log_t0 = 0,
log_cv_len = log(1),
log_std_index = log(1)
)
lower=unlist(parameters.L)
upper=unlist(parameters.U)
map = list(
#log_std_log_N0 = factor(NA),
#log_std_log_R = factor(NA),
log_std_log_F = factor(NA),
log_Linf=factor(NA),
log_t0=factor(NA)
#log_std_index=factor(NA)
)
rnames=c("dev_log_R","dev_log_F","dev_log_N0")
a<-run_alscl1(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
na_matrix<-matrix(1,nrow=9,ncol=21)
na_matrix[which(cl[,2:22]==0)]=0
View(na_matrix)
View(cl)
a<-run_alscl(data.CatL=cl,data.wgt = wgt,data.mat = mat,rec.age=1,nage=5,M=0.3,sel_L50=40,sel_L95=45,parameters = parameters,parameters.L = parameters.L,parameters.U =parameters.U,map=map)
